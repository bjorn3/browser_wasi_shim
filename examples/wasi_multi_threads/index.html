<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<p id="note">
  ####
</p>

<script type="module">
  import { File, OpenFile, ConsoleStdout, PreopenDirectory, WASIFarm, WASIFarmAnimal } from "../../dist/index.js";

  const farm = new WASIFarm(
    new OpenFile(new File([])), // stdin
    ConsoleStdout.lineBuffered(msg => console.log(`[WASI stdout] ${msg}`)),
    ConsoleStdout.lineBuffered(msg => console.warn(`[WASI stderr] ${msg}`)),
    [],
    { debug: true },
  );

  console.log(farm);

  const worker = new Worker("./worker.js", { type: "module" });
  // const worker = new Worker(new URL("./worker.js", import.meta.url).href, { type: "module" });

  console.log(worker);

  console.log("self.Worker", self.Worker);

  worker.postMessage({
    wasi_ref: farm.get_ref(),
  });

  console.log("Sent WASI ref to worker");

</script>
</body>
</html>
